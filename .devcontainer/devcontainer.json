{
  "name": "FoundryVTT Module Dev (wy-terminal)",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:1-20",

  // Publish FoundryVTT's port via Docker (-p flag) so it binds to 0.0.0.0
  // on the host, making it reachable from remote systems on the network.
  // "forwardPorts" alone binds to 127.0.0.1 (localhost only).
  "appPort": ["30000:30000"],

  // Keep forwardPorts for VS Code UI integration (Ports panel, notifications)
  // and Codespaces public URL forwarding.
  "forwardPorts": [30000],
  "portsAttributes": {
    "30000": {
      "label": "FoundryVTT",
      "onAutoForward": "notify",
      "visibility": "public"
    }
  },

  // Pass secrets into the container.
  // In Codespaces these resolve from Codespaces Secrets automatically.
  // Locally (Docker), set them as Windows User environment variables first:
  "remoteEnv": {
    "FOUNDRY_USERNAME":    "${localEnv:FOUNDRY_USERNAME}",
    "FOUNDRY_PASSWORD":    "${localEnv:FOUNDRY_PASSWORD}",
    "FOUNDRY_LICENSE_KEY": "${localEnv:FOUNDRY_LICENSE_KEY}",
    "FOUNDRY_BUILD":       "${localEnv:FOUNDRY_BUILD}",
    "OPENAI_API_KEY":      "${localEnv:OPENAI_API_KEY}",
    "SSH_AUTH_SOCK":       "/ssh-agent"
  },

  // Mount the host's SSH agent socket into the container for Git operations.
  "mounts": [
    "source=${env:SSH_AUTH_SOCK},target=/ssh-agent,type=bind"
  ],

  // Install Node dependencies after the container is created.
  "postCreateCommand": "npm install",

  // Download & launch FoundryVTT using Codespaces secrets:
  //   FOUNDRY_USERNAME, FOUNDRY_PASSWORD, FOUNDRY_LICENSE_KEY, FOUNDRY_BUILD
  "postStartCommand": "bash .devcontainer/setup-foundry.sh",

  "customizations": {
    "vscode": {
      "extensions": [
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode"
      ]
    }
  }
}
