<div class="wy-view-commandcode">
  <div class="wy-section-title">COMMAND CODE AUTHORIZATION</div>

  {{!-- Current Clearance Display --}}
  <div class="wy-cc-status-display">
    <div class="wy-cc-current-label">CURRENT CLEARANCE LEVEL</div>
    <div class="wy-cc-current-value wy-cc-level-{{playerClearance}}">{{playerClearance}}</div>
  </div>

  {{#if isGM}}
  {{!-- GM: No keypad needed — always MASTER_OVERRIDE. Show per-user code management. --}}
  <div class="wy-border-box" style="margin-top: 16px; border-color: var(--wy-amber);">
    <div style="color: var(--wy-amber); font-size: 11px; letter-spacing: 2px; margin-bottom: 4px;">
      GM TERMINAL — MASTER OVERRIDE ACTIVE
    </div>
    <div style="color: var(--wy-green-dim); font-size: 10px; letter-spacing: 1px;">
      ALL CLASSIFIED SYSTEMS ACCESSIBLE. NO AUTHORIZATION REQUIRED.
    </div>
  </div>

  <div class="wy-section-title" style="margin-top: 16px;">USER CLEARANCE &amp; COMMAND CODES</div>
  <div class="wy-border-box" id="wy-user-codes-section">
    <div style="color: var(--wy-green-dim); font-size: 10px; letter-spacing: 1px; margin-bottom: 12px;">
      EACH USER HAS AN INDEPENDENT CLEARANCE LEVEL AND UNIQUE 8-DIGIT COMMAND CODE.
    </div>

    {{#each userList}}
    <div class="wy-user-clearance-row" data-user-id="{{this.id}}">
      <div class="wy-user-row-header">{{this.name}}</div>
      <div class="wy-user-row-fields">
        <div class="wy-user-field-group">
          <label class="wy-user-field-label">CLEARANCE</label>
          <select class="wy-setting-input" data-field="clearance">
            <option value="CREWMEMBER" {{#if (eq this.clearance 'CREWMEMBER')}}selected{{/if}}>CREWMEMBER</option>
            <option value="NONE" {{#if (eq this.clearance 'NONE')}}selected{{/if}}>NONE</option>
            <option value="MEDICAL" {{#if (eq this.clearance 'MEDICAL')}}selected{{/if}}>MEDICAL</option>
            <option value="CAPTAIN" {{#if (eq this.clearance 'CAPTAIN')}}selected{{/if}}>CAPTAIN</option>
            <option value="CORPORATE" {{#if (eq this.clearance 'CORPORATE')}}selected{{/if}}>CORPORATE</option>
            <option value="MASTER_OVERRIDE" {{#if (eq this.clearance 'MASTER_OVERRIDE')}}selected{{/if}}>MASTER OVERRIDE</option>
          </select>
        </div>
        <div class="wy-user-field-group">
          <label class="wy-user-field-label">CODE ROLE</label>
          <select class="wy-setting-input" data-field="role">
            <option value="CREWMEMBER" {{#if (eq this.role 'CREWMEMBER')}}selected{{/if}}>CREWMEMBER</option>
            <option value="MEDICAL" {{#if (eq this.role 'MEDICAL')}}selected{{/if}}>MEDICAL</option>
            <option value="CAPTAIN" {{#if (eq this.role 'CAPTAIN')}}selected{{/if}}>CAPTAIN</option>
            <option value="CORPORATE" {{#if (eq this.role 'CORPORATE')}}selected{{/if}}>CORPORATE</option>
            <option value="MASTER_OVERRIDE" {{#if (eq this.role 'MASTER_OVERRIDE')}}selected{{/if}}>MASTER OVERRIDE</option>
          </select>
        </div>
        <div class="wy-user-field-group">
          <label class="wy-user-field-label">CMD CODE</label>
          <input class="wy-setting-input" type="text" data-field="code" value="{{this.code}}" placeholder="8-DIGIT CODE" maxlength="8" style="font-family: monospace; letter-spacing: 2px;" />
        </div>
      </div>
    </div>
    {{/each}}

    {{#unless userList.length}}
    <div style="color: var(--wy-amber-dim); font-size: 10px; text-align: center; padding: 12px;">
      NO PLAYER USERS FOUND. CREATE USERS IN FOUNDRYVTT USER MANAGEMENT.
    </div>
    {{/unless}}

    <div style="margin-top: 12px; display: flex; gap: 8px;">
      <button class="wy-muthur-send" data-action="save-user-codes" style="flex: 1;">SAVE ALL</button>
      <button class="wy-muthur-send" data-action="regenerate-codes" style="flex: 1;">REGENERATE ALL CODES</button>
    </div>
    <div style="margin-top: 8px;">
      <button class="wy-muthur-send" data-action="revoke-all-clearance" style="width: 100%; border-color: var(--wy-amber-dim); color: var(--wy-amber);">⏻ REVOKE ALL CLEARANCE — SET ALL CREWMEMBER</button>
    </div>
  </div>

  {{else}}
  {{!-- Player: Show keypad for code entry --}}
  <div class="wy-cc-keypad-container">
    <div class="wy-keypad-title">ENTER COMMAND CODE</div>
    <div class="wy-keypad-subtitle">AUTHORIZATION REQUIRED FOR CLASSIFIED ACCESS</div>
    <div class="wy-keypad-display" id="wy-cc-keypad-display"></div>
    <div class="wy-keypad-grid">
      <button class="wy-keypad-btn" data-cc-keypad="1">1</button>
      <button class="wy-keypad-btn" data-cc-keypad="2">2</button>
      <button class="wy-keypad-btn" data-cc-keypad="3">3</button>
      <button class="wy-keypad-btn" data-cc-keypad="4">4</button>
      <button class="wy-keypad-btn" data-cc-keypad="5">5</button>
      <button class="wy-keypad-btn" data-cc-keypad="6">6</button>
      <button class="wy-keypad-btn" data-cc-keypad="7">7</button>
      <button class="wy-keypad-btn" data-cc-keypad="8">8</button>
      <button class="wy-keypad-btn" data-cc-keypad="9">9</button>
      <button class="wy-keypad-btn wy-keypad-clear" data-cc-keypad="clear">CLR</button>
      <button class="wy-keypad-btn" data-cc-keypad="0">0</button>
      <button class="wy-keypad-btn wy-keypad-enter" data-cc-keypad="enter">ENT</button>
    </div>
    <div style="margin-top: 12px;">
      <button class="wy-muthur-send" data-action="logout-clearance" style="width: 100%; border-color: var(--wy-amber-dim); color: var(--wy-amber);">⏻ LOGOUT — REVOKE CLEARANCE</button>
    </div>
  </div>
  {{/if}}
</div>
