<div class="wy-view-settings">
  <div class="wy-section-title">TERMINAL CONFIGURATION</div>

  {{#if isGM}}
  <div class="wy-border-box" style="margin-bottom: 16px; border-color: var(--wy-amber);">
    <div style="color: var(--wy-amber); font-size: 11px; letter-spacing: 2px; margin-bottom: 8px;">▶ ACTIVE SHIP PROFILE</div>
    <div class="wy-setting-row">
      <span class="wy-setting-label">SHIP</span>
      <select class="wy-setting-input" data-setting="activeShip">
        {{#each availableShips}}
        <option value="{{this.id}}" {{#if (eq this.id ../activeShip)}}selected{{/if}}>{{this.label}}</option>
        {{/each}}
      </select>
    </div>
    <div style="margin-top: 8px;">
      <button class="wy-muthur-send" data-action="switch-ship" style="width: 100%;">⚡ SWITCH SHIP — APPLY PROFILE DEFAULTS</button>
    </div>
    <div style="color: var(--wy-amber-dim); font-size: 10px; margin-top: 6px; letter-spacing: 1px;">
      WARNING: SWITCHING SHIP RESETS SYSTEMS, CREW, AND SHIP IDENTITY TO PROFILE DEFAULTS.
    </div>
  </div>
  {{/if}}

  <div class="wy-border-box">
    <div class="wy-setting-row">
      <span class="wy-setting-label">SHIP NAME</span>
      <input class="wy-setting-input" type="text"
             data-setting="shipName"
             value="{{shipName}}" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">SHIP CLASS</span>
      <input class="wy-setting-input" type="text"
             data-setting="shipClass"
             value="{{shipClass}}" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">SHIP REGISTRY</span>
      <input class="wy-setting-input" type="text"
             data-setting="shipRegistry"
             value="{{shipRegistry}}" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">CRT SCANLINES</span>
      <input type="checkbox" data-setting="scanlines" {{#if scanlines}}checked{{/if}} />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">CRT FLICKER</span>
      <input type="checkbox" data-setting="crtFlicker" {{#if crtFlicker}}checked{{/if}} />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">SOUND EFFECTS</span>
      <input type="checkbox" data-setting="soundEnabled" {{#if soundEnabled}}checked{{/if}} />
    </div>
  </div>

  {{#if isGM}}
  <div class="wy-section-title" style="margin-top: 16px;">MU/TH/UR AI ENGINE</div>

  <div class="wy-border-box" style="margin-bottom: 12px; border-color: var(--wy-green-dim);">
    <div style="color: var(--wy-green); font-size: 11px; letter-spacing: 2px; margin-bottom: 8px;">▶ AI PROVIDER SETUP</div>
    <div style="color: var(--wy-green-dim); font-size: 10px; letter-spacing: 1px; line-height: 1.6;">
      MU/TH/UR REQUIRES AN OPENAI-COMPATIBLE API ENDPOINT. TWO OPTIONS:<br><br>
      <span style="color: var(--wy-green);">OPTION A — OPENAI (CLOUD)</span><br>
      &nbsp; API BASE URL: <span style="color: var(--wy-amber);">https://api.openai.com/v1</span><br>
      &nbsp; API KEY: YOUR OPENAI KEY (sk-...)<br>
      &nbsp; MODEL: gpt-4o-mini, gpt-4.1-nano, OR gpt-4o<br><br>
      <span style="color: var(--wy-green);">OPTION B — LOCAL OLLAMA (FREE / OFFLINE)</span><br>
      &nbsp; 1. INSTALL OLLAMA: <span style="color: var(--wy-amber);">https://ollama.com</span><br>
      &nbsp; 2. PULL A MODEL: <span style="color: var(--wy-amber);">ollama pull llama3.1:8b</span><br>
      &nbsp; 3. SET FIELDS BELOW:<br>
      &nbsp; API BASE URL: <span style="color: var(--wy-amber);">http://localhost:11434/v1</span><br>
      &nbsp; API KEY: LEAVE BLANK (NO AUTH REQUIRED)<br>
      &nbsp; MODEL: llama3.1:8b, mistral:7b, OR phi3:mini<br>
    </div>
  </div>

  <div class="wy-border-box">
    <div class="wy-setting-row">
      <span class="wy-setting-label">API BASE URL</span>
      <input class="wy-setting-input" type="text"
             data-setting="openaiBaseUrl"
             value="{{openaiBaseUrl}}"
             placeholder="https://api.openai.com/v1" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">API KEY</span>
      <input class="wy-setting-input" type="password"
             data-setting="openaiApiKey"
             value="{{openaiApiKey}}"
             placeholder="sk-... (BLANK FOR OLLAMA)" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">AI MODEL</span>
      <input class="wy-setting-input" type="text"
             data-setting="openaiModel"
             value="{{openaiModel}}"
             placeholder="gpt-4o-mini" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">SCENARIO PLUGIN</span>
      <span class="wy-setting-input" style="color: var(--wy-green-dim); letter-spacing: 1px;">{{muthurPlugin}} (TIED TO SHIP PROFILE)</span>
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">EXTERNAL SERVER URL</span>
      <input class="wy-setting-input" type="text"
             data-setting="muthurUrl"
             value="{{muthurUrl}}"
             placeholder="(BLANK = USE BUILT-IN ENGINE)" />
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">STATUS FILE PATH</span>
      <input class="wy-setting-input" type="text"
             data-setting="statusPath"
             value="{{statusPath}}"
             placeholder="modules/wy-terminal/status/" />
    </div>
  </div>
  {{/if}}

  <div style="margin-top: 16px; display: flex; gap: 8px;">
    <button class="wy-muthur-send" data-action="save-settings" style="flex:1;">SAVE CONFIGURATION</button>
    <button class="wy-muthur-send" data-action="reload-status" style="flex:1;">RELOAD STATUS</button>
    {{#if isGM}}
    <button class="wy-muthur-send" data-action="clear-chat" style="flex:1;">CLEAR CHAT LOG</button>
    {{/if}}
  </div>

  {{#if isGM}}
  <div class="wy-section-title" style="margin-top: 16px; color: var(--wy-amber);">RESET GAME SETTINGS</div>
  <div class="wy-border-box" style="border-color: var(--wy-amber-dim);">
    <div style="color: var(--wy-amber-dim); font-size: 10px; letter-spacing: 1px; margin-bottom: 8px;">
      WARNING: THESE ACTIONS CANNOT BE UNDONE. EACH BUTTON RESETS THE SELECTED DATA TO DEFAULTS.
    </div>
    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
      <button class="wy-muthur-send" data-action="reset-gameclock" style="flex:1; min-width: 140px; border-color: var(--wy-amber-dim); color: var(--wy-amber);">&#x27F2; RESET GAME CLOCK</button>
      <button class="wy-muthur-send" data-action="reset-logs" style="flex:1; min-width: 140px; border-color: var(--wy-amber-dim); color: var(--wy-amber);">&#x27F2; RESET LOGS</button>
    </div>
    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
      <button class="wy-muthur-send" data-action="reset-crew" style="flex:1; min-width: 140px; border-color: var(--wy-amber-dim); color: var(--wy-amber);">&#x27F2; RESET CREW</button>
      <button class="wy-muthur-send" data-action="reset-shipstatus" style="flex:1; min-width: 140px; border-color: var(--wy-amber-dim); color: var(--wy-amber);">&#x27F2; RESET SHIP STATUS</button>
    </div>
    <div style="margin-top: 8px;">
      <button class="wy-muthur-send" data-action="reset-all" style="width: 100%; border-color: var(--wy-amber); color: var(--wy-amber); font-weight: bold;">&#x26A0; RESET ALL GAME SETTINGS</button>
    </div>
  </div>

  <div class="wy-section-title" style="margin-top: 16px;">PLAYER SCHEMATIC ACCESS</div>
  <div class="wy-border-box" id="wy-ship-access-section">
    <div style="color: var(--wy-green-dim); font-size: 10px; letter-spacing: 1px; margin-bottom: 8px;">
      CONTROL WHICH SHIPS ARE VISIBLE TO PLAYERS ON THE SCHEMATICS PAGE. UNCHECKED SHIPS ARE HIDDEN FROM PLAYER TERMINALS.
    </div>
    {{#each shipAccessList}}
    <div class="wy-setting-row">
      <span class="wy-setting-label">{{this.name}}<span class="wy-text-dim" style="margin-left: 6px; font-size: 9px;">{{this.shipClass}}</span></span>
      <input type="checkbox" data-ship-access="{{this.id}}" {{#if this.enabled}}checked{{/if}} />
    </div>
    {{/each}}
    <div style="margin-top: 8px;">
      <button class="wy-muthur-send" data-action="save-ship-access" style="width: 100%;">SAVE SHIP ACCESS</button>
    </div>
  </div>

  <div class="wy-section-title" style="margin-top: 16px;">NAVIGATION</div>
  <div class="wy-border-box" id="wy-nav-settings-section">
    <div style="color: var(--wy-green-dim); font-size: 10px; letter-spacing: 1px; margin-bottom: 8px;">
      SET CURRENT NAVIGATION PARAMETERS. ENGINES AND THRUSTERS STATUS DERIVED FROM SHIP SYSTEMS.
    </div>

    <div class="wy-setting-row">
      <span class="wy-setting-label">HEADING</span>
      <input class="wy-setting-input" type="text" data-nav="heading" value="{{navData.heading}}" placeholder="042.7" />
    </div>
    <div class="wy-setting-row">
      <span class="wy-setting-label">SPEED</span>
      <input class="wy-setting-input" type="text" data-nav="speed" value="{{navData.speed}}" placeholder="STATION KEEPING" />
    </div>
    <div class="wy-setting-row">
      <span class="wy-setting-label">FUEL</span>
      <input class="wy-setting-input" type="text" data-nav="fuel" value="{{navData.fuel}}" placeholder="87%" />
    </div>
    <div class="wy-setting-row">
      <span class="wy-setting-label">ETA</span>
      <input class="wy-setting-input" type="text" data-nav="eta" value="{{navData.eta}}" placeholder="14 WEEKS" />
    </div>
    <div class="wy-setting-row">
      <span class="wy-setting-label">POSITION</span>
      <input class="wy-setting-input" type="text" data-nav="position" value="{{navData.position}}" placeholder="SECTOR 87-C / ZETA RETICULI" />
    </div>
    <div class="wy-setting-row">
      <span class="wy-setting-label">DESTINATION</span>
      <input class="wy-setting-input" type="text" data-nav="destination" value="{{navData.destination}}" placeholder="SUTTER'S WORLD" />
    </div>

    <div style="margin-top: 4px; color: var(--wy-green-dim); font-size: 10px; letter-spacing: 1px;">
      ENGINES: {{navData.engineStatus}} &nbsp;|&nbsp; THRUSTERS: {{navData.thrusterStatus}} &nbsp;(FROM SYSTEMS)
    </div>

    <div style="margin-top: 8px;">
      <button class="wy-muthur-send" data-action="save-nav" style="width: 100%;">SAVE NAVIGATION DATA</button>
    </div>
  </div>

  {{/if}}
</div>
